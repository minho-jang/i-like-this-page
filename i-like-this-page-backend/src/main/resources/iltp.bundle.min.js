(()=>{"use strict";const e="http://iltp.link/api/v1",t="Bearer ",n="iltp_token",o=()=>new Promise(((t,o)=>{const r=localStorage.getItem(n);r?t(r):fetch(`${e}/token`).then((e=>e.json())).then((e=>{if(console.log(e),!e.success)return void handleError(e.error);const o=e.response;localStorage.setItem(n,o),t(o)})).catch((e=>{console.err(e),o()}))})),r=e=>{const t=document.createElement("span");t.setAttribute("id","iltp-box");const n=`\n    border-radius: 15%;\n    background-color: ${e?"rgb(255, 202, 202)":"rgb(214, 214, 214)"};\n    font-family: 'Fira Sans', sans-serif;\n    padding: 0.5rem 1rem;`;t.setAttribute("style",n);const o=document.createElement("span");o.setAttribute("id","iltp-content-icon"),o.innerText=e?"ðŸ’•":"ðŸ–¤",t.appendChild(o);const r=document.createElement("span");r.setAttribute("id","iltp-content-number"),r.setAttribute("style","margin-left: .4rem;"),r.innerText=e?"0":"ERROR",t.appendChild(r),s(),c.appendChild(t);const i=document.createElement("link");i.setAttribute("href","css/i-like-this-page.css"),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),document.head.appendChild(i)},s=()=>{c.childNodes.length>0&&c.removeChild(c.childNodes[0])};let i=!1;const c=document.getElementById("i-like-this-page");c.setAttribute("style","\n  display: inline-block;\n  cursor: pointer;\n"),c.addEventListener("click",(function(){const e=window.location.host+window.location.pathname;i?a(e):l(e)}));const l=n=>{(n=>new Promise(((r,s)=>{o().then((o=>{const s=`${e}/like`,i={method:"POST",headers:{Authorization:t+o,"Content-Type":"application/json"},body:JSON.stringify({url:n})};r(fetch(s,i).then((e=>e.json())))})).catch((e=>{console.err(e),s()}))})))(n).then((e=>{console.log(e),e.success?(i=e.response.likeStatus,document.getElementById("iltp-content-number").innerText=e.response.likeCount):d(e.error)})).catch((e=>d(e)))},a=n=>{(n=>new Promise(((r,s)=>{o().then((o=>{const s=`${e}/like`,i={method:"DELETE",headers:{Authorization:t+o,"Content-Type":"application/json"},body:JSON.stringify({url:n})};r(fetch(s,i).then((e=>e.json())))})).catch((e=>{console.err(e),s()}))})))(n).then((e=>{console.log(e),e.success?(i=e.response.likeStatus,document.getElementById("iltp-content-number").innerText=e.response.likeCount):d(e.error)})).catch((e=>d(e)))},d=e=>{console.error(e),r(!1)};r(!0),window.addEventListener("load",(()=>{(n=>{(n=>new Promise(((r,s)=>{o().then((o=>{const s=new URL(`${e}/like`),i={url:n};s.search=new URLSearchParams(i).toString(),r(fetch(s,{method:"GET",headers:{Authorization:t+o}}).then((e=>e.json())))})).catch((e=>{console.err(e),s()}))})))(n).then((e=>{if(!e.success)return console.error(e.error.message),void renderErrorButtonTo(c,e.error.status);console.log(e),i=e.response.likeStatus,document.getElementById("iltp-content-number").innerHTML=e.response.likeCount})).catch((e=>d(e)))})(window.location.host+window.location.pathname)}))})();